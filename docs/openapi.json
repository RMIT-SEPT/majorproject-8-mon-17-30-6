{
    "openapi": "3.0.0",
    "info": {
        "title": "AGME API",
        "version": "0"
    },
    "tags": [
        {
            "name": "AGME Api",
            "description": "The AGME API provides services for registering companies and users"
        }
    ],
    "paths": {
        "/signup": {
            "post": {
              "description": "This is API is open for the general public to sign either as a basic user, company (provider) or an employee for registered companies",
                "operationId": "createdNewUser",
                "requestBody": {
                    "$ref": "#/components/requestBodies/SignupRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull signup",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/SignupResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Signup"
                ]
            }
        },
        "/login": {
            "post": {
              "description": "This API is to be consumed for authenticating companies, users and employees",
                "operationId": "createAuthenticationRequest",
                "requestBody": {
                    "$ref": "#/components/requestBodies/LoginRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/LoginResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Login"
                ]
            }
        },
        "/user/availability":{
          "post": {
            "summary": "API for retrieval of a company's employee availability",
            "description": "Retrieve times available for a particular employee at a particular date",
                "operationId": "retrieveServiceAvailability",
                "requestBody": {
                    "$ref": "#/components/requestBodies/retrieveServiceAvailabilityRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ServiceTypeResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "User"
                ]
          },
          "get": {
            "summary": "API for retrieval of a service availability",
            "description": "This API returns all available times (1 hour slot) for a particular service",
                "operationId": "getServiceAvailability",
                "responses": {
                    "200": {
                        "description": "Successfull login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetServiceAvailabilityResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "User"
                ]
            }
        },
        "/user/services": {
            "get": {
              "summary": "Returns a list of services and each company that offers them",
              "description": "Returns a list of services and each company that offers them",
                "operationId": "getServices",
                "responses": {
                    "200": {
                        "description": "Successfull login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetServicesResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "User"
                ]
            }
        },
        "/user/new-booking": {
            "post": {
              "summary": "Creates a new booking",
              "description": "Calls the API and creates a booking in the system",              
                "operationId": "createNewBooking",
                "requestBody": {
                    "$ref": "#/components/requestBodies/NewUserBookingRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull login",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/NewBookingResponseBody"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "User"
                ]
            }
        },
        "/company/new-service":{
          "description": "This will create a new service, if the service already exists, then the company creating it will just add be added to the service",
            "post": {
                "operationId": "createNewService",
                "requestBody": {
                    "$ref": "#/components/requestBodies/CreateNewServiceRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull",
                        "content": {
                            "application/json": {
                            }
                        }
                    }
                },
                "tags": [
                    "Company"
                ]
            }          
        },
        "/company/bookings":{
          "description": "Retrieves all bookings from a company",
            "get": {
                "operationId": "retrieveCompanyBookings",
                "responses": {
                    "200": {
                        "description": "Successfull",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CompanyBookings"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Company"
                ]
            }          
        },
        "/employee/bookings":{
          "description": "Retrieves all bookings from an employee",
            "get": {
                "operationId": "retrieveEmployeeBookings",
                "responses": {
                    "200": {
                        "description": "Successfull",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CompanyBookings"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Employee"
                ]
            }          
        },             
        "/api/employee/employees": {
            "post": {
                "operationId": "newEmployee",
                "requestBody": {
                    "$ref": "#/components/requestBodies/NewEmployeeRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull signup",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/NewEmployeeResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Employee"
                ]
            },
            "get": {
                "operationId": "getEmployees",
                "responses": {
                    "200": {
                        "description": "Successfull signup",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetEmployeesResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Employee"
                ]
            }
        },
        "/api/booking/bookings": {
            "post": {
                "operationId": "newBooking",
                "requestBody": {
                    "$ref": "#/components/requestBodies/NewBookingRequestBody"
                },
                "responses": {
                    "200": {
                        "description": "Successfull booking",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Booking"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Bookings"
                ]
            },
            "get": {
                "operationId": "getBookings",
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetBookingsResponse"
                                }
                            }
                        }
                    }
                },
                "tags": [
                    "Bookings"
                ]
            }
        }
    },
    "components": {
        "requestBodies": {
          "CreateNewServiceRequestBody":{
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties":{
                              "name": {
                                "type": "string",
                                "description": "Name of the new service",
                                "example": "GYM"
                              },
                              "description": {
                                "type": "string",
                                "description": "The description for the new service",
                                "example": "Gym equipment maintenance and installation"
                              }
                            }
                        }
                    }
                }   
          },
          "retrieveServiceAvailabilityRequestBody":{
                  "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/retrieveServiceAvailabilityRequestBody"
                        }
                    }
                }          
          },
          "NewUserBookingRequestBody":{
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/NewUserBookingRequest"
                        }
                    }
                }            
          },
            "NewBookingRequestBody": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Booking"
                        }
                    }
                }
            },
            "NewEmployeeRequestBody": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/NewEmployeeRequest"
                        }
                    }
                }
            },
            "ServiceTypeRequestBody": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/ServiceTypeRequest"
                        }
                    }
                }
            },
            "SignupRequestBody": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/SignupRequestBody"
                        }
                    }
                }
            },
            "LoginRequestBody": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/LoginRequestBody"
                        }
                    }
                }
            }
        },
        "schemas": {
          "CompanyBooking":{
            "type": "object",
            "properties":{
              "date":{
                "type": "string",
                "description": "A date in format YYYY-MM-DD",
                "example": "2020-10-05"
              },
              "bookings":{
                "type": "array",
                "items":{
                  "type": "object",
                  "properties":{
                    "serviceType": {
                      "type": "string",
                      "description": "The type of service",
                      "example": "GYM"
                    },
                    "employee":{
                      "type": "object",
                      "description": "Details of the employee providing the service",
                      "example":{"$ref": "#/components/schemas/Employee/example"}
                    },
                    "times": {
                      "type": "array",
                      "items":{
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 23
                      },
                      "example": [8,9,10]
                    }
                  }
                }
              }
            }
          },
          "CompanyBookings":{
            "type": "array",
            "items":{"$ref": "#/components/schemas/CompanyBooking"}
          },
          "NewBookingResponseBody":{
            "type": "string",
            "example": "Booking created"
          },
          "NewUserBookingRequest":{
            "type": "object",
            "properties":{
              "date": {
                "type": "string",
                "description": "Date of the booking in format YYYY-MM-DD",
                "example": "2020-10-05"
              },
              "companyUsername": {
                "type": "string",
                "description": "The company username that uniquely identifies it",
                "example": "fitnessfirst"
              },
              "times": {
                "type": "array",
                "items":{
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 23
                },
                "example": [8, 9, 10]
              },
              "serviceType": {
                "type": "string",
                "description": "The type of service",
                "example": "GYM"
              }
            }
          },
          "GetServiceAvailabilityResponse":{
            "type": "object",
            "properties":{
              "id":{
                "type": "number",
                "example": "1",
                "description": "The unique ID of the company"
              },
              "name": {
                "type": "string",
                "description": "Name of the service",
                "example": "GYM"
              },
              "description": {
                "type": "string",
                "description": "A description of the service",
                "example": "Install equipment"
              },
              "companies":{
                "type": "array",
                "items": {"$ref": "#/components/schemas/Company"}
              }
            }
          },
          "retrieveServiceAvailabilityRequestBody":{
            "type": "object",
            "properties":{
              "date": {
                "type": "string",
                "example": "2020-09-20"
              },
              "companyUsername":{
                "type": "string",
                "description": "User name of the company to be queried",
                "example": "fitnessfirst"
              },
              "employeeUsername":{
                "type": "string",
                "description": "User name of the employee",
                "example": "josh"
              }
            }
          },
            "Booking": {
                "type": "object",
                "properties": {
                    "employee": {
                        "$ref": "#/components/schemas/Employee"
                    },
                    "date": {
                        "type": "string"
                    },
                    "company": {
                        "$ref": "#/components/schemas/Company"
                    },
                    "time": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 23
                    }
                }
            },
            "GetBookingsResponse": {
                "type": "array",
                "items": {
                    "$ref": "#/components/schemas/Booking"
                }
            },
            "GetEmployeesResponse": {
                "type": "array",
                "items": {
                    "$ref": "#/components/schemas/Employee"
                }
            },
            "NewEmployeeRequest": {
                "$ref": "#/components/schemas/Employee"
            },
            "NewEmployeeResponse": {
                "$ref": "#/components/schemas/Employee"
            },
            "User": {
                "type": "object",
                "properties": {
                    "username": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "confirmPassword": {
                        "type": "string"
                    },
                    "address": {
                        "type": "string"
                    },
                    "phone": {
                        "type": "string"
                    },
                    "role": {
                        "type": "string"
                    }
                }
            },
            "Company": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/User"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "companyName": {
                                "type": "string"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "properties":{
                          "employees":{
                          "type": "array",
                          "items":{"$ref": "#/components/schemas/Employee"}
                        }
                        }
                    }
                ]
            },
            "Employee": {
              "example":{
                        "username": "b",
                        "name": "mark",
                        "password": "$2a$10$.Zsum4sGX5ma9uKI.",
                        "confirmPassword": null,
                        "address": "address",
                        "phone": "foobar",
                        "lastLogin": "2020-09-16T13:40:57.158+00:00",
                        "createdAt": "2020-09-16T13:40:57.158+00:00",
                        "updatedAt": "2020-09-16T13:40:57.158+00:00",
                        "role": "EMPLOYEE",
                        "userType": "Plumber",
                        "id": 1,
                        "company": null,
                        "enabled": false,
                        "authorities": [
                            {
                                "authority": "EMPLOYEE"
                            }                ],
                "accountNonExpired": false,
                "accountNonLocked": false,
                "credentialsNonExpired": false
            },

                "allOf": [
                    {
                        "$ref": "#/components/schemas/User"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "company": {
                                "$ref": "#/components/schemas/Company"
                            },
                            "userType": {
                                "type": "string"
                            }
                        }
                    }
                ]
            },
            "GetServicesResponse": {
                "type": "array",
                "items": {
                    "$ref": "#/components/schemas/ServiceTypeResponse"
                }
            },
            "ServiceTypeRequest": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "example": "GYM"
                    },
                    "description": {
                        "type": "string",
                        "example": "A gym is a club, building, or large room, usually containing special equipment, where people go to do physical exercise and get fit."
                    }
                }
            },
            "ServiceTypeResponse": {
                "type": "object",
                "properties": {
                    "id": {
                        "description": "primary key for service type",
                        "type": "string",
                        "example": "1"
                    },
                    "name": {
                        "type": "string",
                        "example": "GYM"
                    },
                    "description": {
                        "type": "string",
                        "example": "A gym is a club, building, or large room, usually containing special equipment, where people go to do physical exercise and get fit."
                    }
                }
            },
            "LoginResponse": {
                "type": "object",
                "properties": {
                    "jwt": {
                        "description": "A JWT authentication token",
                        "type": "string"
                    }
                }
            },
            "LoginRequestBody": {
                "type": "object",
                "properties": {
                    "role": {
                        "type": "string",
                        "enum": [
                            "USER",
                            "ADMIN",
                            "COMPANY"
                        ]
                    },
                    "username": {
                        "description": "A username for the service user. This must be unique in the database system.",
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    }
                }
            },
            "SignupRequestBody": {
                "type": "object",
                "properties": {
                    "role": {
                        "type": "string",
                        "enum": [
                            "USER",
                            "ADMIN",
                            "COMPANY"
                        ]
                    },
                    "username": {
                        "description": "A username for the service user. This must be unique in the database system.",
                        "type": "string"
                    },
                    "name": {
                        "description": "Full name of the user",
                        "type": "string"
                    },
                    "phone": {
                        "type": "string"
                    },
                    "address": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "confirmPassword": {
                        "type": "string"
                    }
                }
            },
            "SignupResponse": {
                "type": "object",
                "properties": {
                    "username": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "password": {
                        "type": "string"
                    },
                    "confirmPassword": {
                        "type": "string"
                    },
                    "address": {
                        "type": "string"
                    },
                    "phone": {
                        "type": "string"
                    },
                    "lastLogin": {
                        "type": "string"
                    },
                    "createdAt": {
                        "type": "string"
                    },
                    "updatedAt": {
                        "type": "string"
                    },
                    "role": {
                        "type": "string"
                    },
                    "companyName": {
                        "type": "string"
                    },
                    "companyUsername": {
                        "type": "string"
                    },
                    "userType": {
                        "type": "string"
                    },
                    "company_name": {
                        "type": "string"
                    }
                }
            }
        }
    }
}